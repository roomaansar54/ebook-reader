!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/add/operator/filter")):"function"==typeof define&&define.amd?define("angular-epub-viewer",["exports","@angular/core","rxjs/BehaviorSubject","rxjs/add/operator/filter"],e):e(t["angular-epub-viewer"]={},t.ng.core,t.Rx)}(this,function(t,n,o){"use strict";var i={OPEN_FILE:0,READ_FILE:1,NOT_LOADED_DOCUMENT:2,NOT_DISPLAYED_CHAPTER:3,SEARCH:4,COMPUTE_PAGINATION:5,LOAD_METADATA:6,LOAD_TOC:7};i[i.OPEN_FILE]="OPEN_FILE",i[i.READ_FILE]="READ_FILE",i[i.NOT_LOADED_DOCUMENT]="NOT_LOADED_DOCUMENT",i[i.NOT_DISPLAYED_CHAPTER]="NOT_DISPLAYED_CHAPTER",i[i.SEARCH]="SEARCH",i[i.COMPUTE_PAGINATION]="COMPUTE_PAGINATION",i[i.LOAD_METADATA]="LOAD_METADATA",i[i.LOAD_TOC]="LOAD_TOC";var e=function(){function t(t){var e=this;this.zone=t,this.epub=null,this.currentLocation={startCfi:null,endCfi:null,page:null,chapter:null},this.documentReady=!1,this.isChapterDisplayed=!1,this.computingPagination=!1,this.searchingText=!1,this.padding=null,this.autoPagination=!1,this.autoMetadata=!1,this.autoTOC=!1,this.onDocumentReady=new n.EventEmitter,this.onChapterUnloaded=new n.EventEmitter,this.onChapterDisplayed=new n.EventEmitter,this.onLocationFound=new n.EventEmitter,this.onSearchFinished=new n.EventEmitter,this.onPaginationComputed=new n.EventEmitter,this.onMetadataLoaded=new n.EventEmitter,this.onTOCLoaded=new n.EventEmitter,this.onErrorOccurred=new n.EventEmitter,this._link=new o.BehaviorSubject(null),this.needSearchText=null,this.needComputePagination=!1,this.initEpub=function(t){e.destroyEpub(),e.epub=ePub(t),e.epub.on("book:ready",function(){e.zone.run(function(){e.documentReady=!0,e.onDocumentReady.next(null),e.autoPagination&&(e.needComputePagination=!0),e.autoMetadata&&e.loadMetadata(),e.autoTOC&&e.loadTOC()})}),e.epub.on("book:pageChanged",function(t){e.zone.run(function(){e.computingPagination||(e.currentLocation.page=t.anchorPage,e.onLocationFound.next(e.currentLocation))})}),e.epub.on("renderer:chapterUnloaded",function(){e.zone.run(function(){e.isChapterDisplayed=!1,e.onChapterUnloaded.next(null)})}),e.epub.on("renderer:chapterDisplayed",function(t){e.zone.run(function(){e.isChapterDisplayed=!0,t.label=null,e.onChapterDisplayed.next(t),e.currentLocation.chapter=t,e.onLocationFound.next(e.currentLocation),e.needComputePagination&&e.computePagination()})}),e.epub.on("renderer:resized",function(){e.zone.run(function(){e.needComputePagination=!0,e.autoPagination&&e.computePagination()})}),e.epub.on("renderer:visibleRangeChanged",function(t){e.zone.run(function(){e.currentLocation.startCfi=t.start,e.currentLocation.endCfi=t.end,e.onLocationFound.next(e.currentLocation)})}),e.epub.renderTo("angularEpubViewerComponent")}}return t.prototype.ngAfterViewInit=function(){var e=this;this.linkSubscription=this._link.asObservable().filter(function(t){return null!=t}).subscribe(function(t){e.initEpub({bookPath:t})})},t.prototype.openLink=function(t){this._link.next(t)},t.prototype.openFile=function(e){var n=this;window.FileReader?this.zone.runOutsideAngular(function(){var t=new FileReader;t.onload=function(){n.zone.run(function(){n.initEpub({bookPath:t.result})})},t.onerror=function(){n.zone.run(function(){n.onErrorOccurred.emit(i.READ_FILE)})},t.readAsArrayBuffer(e)}):this.onErrorOccurred.emit(i.OPEN_FILE)},t.prototype.goTo=function(t){this.documentReady?"number"==typeof t?this.epub.displayChapter(t):/.*html$/.test(t)?this.epub["goto"](t):this.epub.displayChapter(t):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.nextPage=function(){this.documentReady?this.epub.nextPage():this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.previousPage=function(){this.documentReady?this.epub.prevPage():this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.searchText=function(e){var n=this;this.documentReady?this.isChapterDisplayed?!e||e.trim().length<=0?this.onErrorOccurred.emit(i.SEARCH):this.searchingText?this.needSearchText=e:(this.searchingText=!0,this.needSearchText=null,this.zone.runOutsideAngular(function(){var t=n.epub.currentChapter.find(e.trim());n.zone.run(function(){n.searchingText=!1,n.needSearchText?n.searchText(n.needSearchText):n.onSearchFinished.next(t)})})):this.onErrorOccurred.emit(i.NOT_DISPLAYED_CHAPTER):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.setStyle=function(t,e){this.documentReady?this.epub.setStyle(t,e):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.resetStyle=function(t){this.documentReady?this.epub.removeStyle(t):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.computePagination=function(){var n=this;this.documentReady?this.isChapterDisplayed?this.computingPagination||(this.computingPagination=!0,this.needComputePagination=!1,this.zone.runOutsideAngular(function(){n.epub.generatePagination().then(function(t){var e=n.epub.pagination.pageFromCfi(n.epub.getCurrentLocationCfi());n.zone.run(function(){n.computingPagination=!1,n.needComputePagination?n.computePagination():(n.onPaginationComputed.next(t),n.currentLocation.page=e,n.onLocationFound.next(n.currentLocation))})})["catch"](function(){n.zone.run(function(){n.computingPagination=!1,n.onErrorOccurred.emit(i.COMPUTE_PAGINATION)})})})):this.onErrorOccurred.emit(i.NOT_DISPLAYED_CHAPTER):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.loadMetadata=function(){var e=this;this.documentReady?this.zone.runOutsideAngular(function(){e.epub.getMetadata().then(function(t){e.zone.run(function(){e.onMetadataLoaded.next(t)})})["catch"](function(){e.zone.run(function(){e.onErrorOccurred.emit(i.LOAD_METADATA)})})}):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.loadTOC=function(){var e=this;this.documentReady?this.zone.runOutsideAngular(function(){e.epub.getToc().then(function(t){e.zone.run(function(){e.onTOCLoaded.next(t)})})["catch"](function(){e.zone.run(function(){e.onErrorOccurred.emit(i.LOAD_TOC)})})}):this.onErrorOccurred.emit(i.NOT_LOADED_DOCUMENT)},t.prototype.destroyEpub=function(){this.documentReady=!1,this.isChapterDisplayed=!1,this.searchingText=!1,this.needSearchText=null,this.computingPagination=!1,this.needComputePagination=!1,this.currentLocation={startCfi:null,endCfi:null,page:null,chapter:null},this.epub&&(this.epub.destroy(),this.epub=null)},t.prototype.ngOnDestroy=function(){this.linkSubscription&&this.linkSubscription.unsubscribe(),this.destroyEpub()},t}();e.decorators=[{type:n.Component,args:[{selector:"angular-epub-viewer",template:'<div id="angularEpubViewerComponent" [style.padding]="padding" #angularEpubViewerComponent></div>',styles:["\n        #angularEpubViewerComponent {\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            overflow: hidden;\n        }\n    "],encapsulation:n.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:n.NgZone}]},e.propDecorators={root:[{type:n.ViewChild,args:["angularEpubViewerComponent",{read:n.ElementRef}]}],padding:[{type:n.Input}],autoPagination:[{type:n.Input}],autoMetadata:[{type:n.Input}],autoTOC:[{type:n.Input}],onDocumentReady:[{type:n.Output,args:["onDocumentReady"]}],onChapterUnloaded:[{type:n.Output,args:["onChapterUnloaded"]}],onChapterDisplayed:[{type:n.Output,args:["onChapterDisplayed"]}],onLocationFound:[{type:n.Output,args:["onLocationFound"]}],onSearchFinished:[{type:n.Output,args:["onSearchFinished"]}],onPaginationComputed:[{type:n.Output,args:["onPaginationComputed"]}],onMetadataLoaded:[{type:n.Output,args:["onMetadataLoaded"]}],onTOCLoaded:[{type:n.Output,args:["onTOCLoaded"]}],onErrorOccurred:[{type:n.Output,args:["onErrorOccurred"]}]};var r=function(){};r.decorators=[{type:n.NgModule,args:[{imports:[],declarations:[e],exports:[e]}]}],t.AngularEpubViewerModule=r,t.AngularEpubViewerComponent=e,t.EpubError=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-epub-viewer.umd.min.js.map
